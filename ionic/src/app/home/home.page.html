<ion-header translucent>
  <ion-toolbar mode="ios">
    <ion-icon slot="start" menuToggle (click)="menu()" color="secondry" mode="md" class="menu" name="menu">
    </ion-icon>
    <ion-title>
      Devices
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content padding>
  <div padding-left>
    <h3>Your devices</h3>
    <div *ngIf="!devices.length">
      No Devices Found!
    </div>
    <ion-button (click)="scanDevice()" mode="ios" class="scanDevices" expand="block" color="primary">
      <span class="scan">Scan For devices
      </span>
    </ion-button>
  </div>
  <div *ngIf="mode === 'device'">
    <ion-list *ngIf="devices.length">
      <ion-card *ngFor="let device of devices; trackBy: trackByDevice">
        <ion-list class="grid-item-header">
          <ion-item class="grid-item-header" [ngClass]="{'yellow' : device.online}">
            <ion-icon slot="start" *ngIf="device && device.type !='access'" name="swap"></ion-icon>
            <ion-icon slot="start" *ngIf="device && device.type == 'access'" name="infinite"></ion-icon>
            <ion-label (click)="askDeviceName(device);">{{device.name}}</ion-label>
            <ion-icon slot="end" *ngIf="device && device.type !='access'" mode="md" class="wifi" name="wifi"></ion-icon>
            <span slot="end" *ngIf="device && device.type =='access'" mode="md">!</span>
          </ion-item>
        </ion-list>

        <ion-list>
          <ion-item>
            <div class="content">
              <p size="12">
                <b>
                  <span size="4" >Device ID:</span>
                </b>
                <span>{{device.device_id}}</span>
              </p>
              <p *ngIf="device.switches.length > 0">
                <span>Switch {{device.switches.length}}</span>
              </p>
            </div>
          </ion-item>
        </ion-list>
        <ion-list class="grid-item-header" *ngIf="device && device.type !='access'">
          <ion-item class="grid-item-header" *ngFor="let switch of device.switches; trackBy: trackBySwitch">
            <ion-icon [ngClass]="{'blue' : switch.status}" slot="start" mode="ios" name="bulb"></ion-icon>
            <span (click)="setSwitchName(switch, device)" [ngClass]="{'blue' : switch.status}">{{switch.name}}</span>
            <ion-buttons slot="start">
              <ion-button slot="icon-only" (click)="switchOn(switch,device)" *ngIf="switch.status === 0" color="medium">
                <ion-icon name="power" mod="md"></ion-icon>
              </ion-button>
              <ion-button slot="icon-only" (click)="switchOff(switch,device)" *ngIf="switch.status === 1" color="dark">
                <ion-icon name="power" mod="ios"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-item>
        </ion-list>
        <ion-list class="grid-item-header" *ngIf="device && device.type =='access'">
          <ion-item class="grid-item-header">
            <ion-icon slot="start" mode="ios" name="add"></ion-icon>
            Add Employee
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon slot="start" name="trash"></ion-icon>
            Remove Employee
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon slot="start" name="eye-off"></ion-icon>
            Disable Employee
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon slot="start" ios="ios-sync" md="md-sync"></ion-icon>
            Sync Employee
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon slot="start" mode="ios" name="list-box"></ion-icon>
            List Employee
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon md="md-options" slot="start" ios="ios-options" m></ion-icon>
            Set special mode
          </ion-item>
          <ion-item class="grid-item-header">
            <ion-icon sloat="start" mode="ios" name="cloud-download"></ion-icon>
            Download Data
          </ion-item>
        </ion-list>
        <ion-list >
          <ion-grid no-padding>
            <ion-row  color="primary">
              <ion-col no-padding>
                <ion-button expand="block" (click)="askWifiPassword(wifi)" color="primary" fill="outline">
                  <ion-icon mode="ios" name="wifi"></ion-icon> Wifi</ion-button>
              </ion-col>
              <ion-col no-padding>
                <ion-button expand="block" (click)="deleteDevice(device)" color="primary" fill="outline">
                  <ion-icon color="primary" mode="md" name="trash"></ion-icon> Delete</ion-button>
              </ion-col>
              <ion-col no-padding>
                <ion-button  expand="block" color="primary" fill="outline">
                  <ion-icon color="primary" name="qr-scanner"></ion-icon> Name</ion-button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-list>
      </ion-card>
    </ion-list>
  </div>
  <div *ngIf="mode === 'discovery'">
    <div *ngIf="!devicePing.isNew">
      This device was configured previously with name
      <b>{{devicePing.name}}</b>
      <br/> Do you want keep this name or change it?
      <br/>
      <ion-button (click)="setDeviceName(devicePing.name,devicePing.chip)" color="primary">Keep</ion-button>
      <ion-button (click)="freshDevice()" color="primary">Start New</ion-button>
    </div>
    <div *ngIf="devicePing.isNew">
      This is a new device device, please set name for the device
      <ion-item>
        <ion-input [(ngModel)]="devicePing.name" required type="text" placeholder="Device Name.."></ion-input>
        <ion-button (click)="setDeviceName(devicePing.name,devicePing.chip)" color="primary">Set Name</ion-button>
      </ion-item>
    </div>
  </div>
  <div *ngIf="mode === 'scan'">
    <div *ngIf="isScanningDevice">
      Turn on Access point on your device and connect to the wifi network.
      <br/> Network name like xSmart-XXXXXX should show up on your phone.
      <br/> Connect to the network with password : 123456789
      <br/> Waiting to connect to wifi network
      <br/>
      <ion-spinner></ion-spinner>
    </div>
    <div *ngIf="xSmartConnect">
      <p size="12">
        <span size="4" class="device-ID">Device ID:</span>
        <span class="device_device_id"> {{devicePing.chip}}</span>
      </p>
      <p size="12">
        <span size="4" class="device-ID">Device Chip:</span>
        <span class="device_device_id"> {{devicePing.chip}}</span>
      </p>
      <p size="12">
        <span size="4" class="device-ID">Device Name:</span>
        <span class="device_device_id"> {{devicePing.name}}</span>
      </p>
      <br/>
      <ion-button (click)="scanWifi()" color="primary">{{loading ? '' : 'Getting Wifi Networks'}}
        <ion-spinner *ngIf="loader" name="bubbles"></ion-spinner>
      </ion-button>
      <Br/>
      <br>
      <div class="networkList">
        <ion-list *ngFor="let wifi of wifinetworks">
          <ion-item class="network" (click)="askWifiPassword(wifi)">
            <ion-item slot="start">
              <ion-icon slot="start" mode="ios" name="wifi"></ion-icon>
              <span>Network</span>
            </ion-item>
            <ion-label>
              <h2>{{wifi.SSID}}</h2>
              <div>
                {{wifi.RSSI}} -- {{wifi.ENC}}
              </div>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>
    </div>
  </div>
</ion-content>