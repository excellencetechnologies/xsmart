<ion-header translucent>
  <ion-toolbar mode="ios">
    <ion-icon slot="start" menuToggle (click)="menu()" color="secondry" mode="md" class="menu" name="menu">
    </ion-icon>
    <ion-title>
      Devices
    </ion-title>
  </ion-toolbar>
</ion-header>
<!-- Old Code -->
<ion-content padding>
  <div *ngIf="!devices.length">
    No Devices Found!
  </div>
  <ion-button (click)="scanDevice()" class="scanDevices" block expand="full" color="primary">
    <span class="scan">Scan For devices</span>
  </ion-button>
  <div>
    Platform: {{message}}
  </div>
  <div *ngIf="mode === 'device'">
    <div *ngIf="devices.length">
      <ion-card *ngFor="let device of devices; trackBy: trackByDevice">
        <ion-item class="grid-item-header" [ngClass]="{'yellow':device.online}">
          <ion-icon slot="start" name="swap"></ion-icon>
          <ion-label (click)="askDeviceName(device);">{{device.name}}</ion-label>
          <ion-icon slot="end" mode="md" class="wifi" name="wifi"></ion-icon>
        </ion-item>
        <ion-card-content class="card_content">
          <!-- <ion-card-title>
            <ion-item>
              <ion-label (click)="askDeviceName(device);">{{device.name}}</ion-label>
              <ion-button (click)="deleteDevice(device)" fill="outline" slot="end">
                <ion-icon name="trash"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-card-title> -->
          <div class="content">
            <p size="12">
              <span size="4" class="device-ID">Device ID:</span>
              <span class="device_device_id">{{device.device_id}}</span>

            </p>
            <p>
              <span size="4" class="device-ID">CHIP:</span>
              <span class="device_device_id">{{device.chip}}</span>
            </p>
            <!-- <p>
              <span size="4" class="device-ID">Last Online:</span>
              <span class="device_device_id">{{device.ttl | date:'short'}}</span>
            </p> -->
            <!-- <p>
              <ion-badge *ngIf="device.online" color="secondary">Online</ion-badge>
              <ion-badge *ngIf="!device.online" color="warning">Offline</ion-badge>
            </p> -->
            <p *ngIf="device.switches.length > 0">
              <span size="4" class="device-ID"> Switches In Device </span>
            </p>
          </div>

          <!-- <ion-toolbar> -->
          <ion-list>
            <ion-item *ngFor="let switch of device.switches; trackBy: trackBySwitch">
              <ion-icon [ngClass]="{'blue' : switch.status}" slot="start" mode="ios" name="bulb"></ion-icon>
              <span (click)="setSwitchName(switch, device)" [ngClass]="{'blue' : switch.status}">{{switch.name}}</span>
              <ion-buttons slot="start">
                <ion-button slot="icon-only" (click)="switchOn(switch,device)" *ngIf="switch.status === 0" color="medium">
                  <ion-icon name="power" mod="md"></ion-icon>
                </ion-button>
                <ion-button slot="icon-only" (click)="switchOff(switch,device)" *ngIf="switch.status === 1" color="dark">
                  <ion-icon name="power" mod="ios"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-item>
          </ion-list>
          <!-- </ion-toolbar> -->
          <ion-item class="icons grid-item" size="12">
            <ion-col class="rightborder" (click)="askWifiPassword(wifi)">
              <ion-icon mode="ios" name="wifi"></ion-icon> Wifi
            </ion-col>
            <ion-col class="rightborder" (click)="deleteDevice(device)">
              <ion-icon mode="md" name="trash"></ion-icon> Dlete
            </ion-col>
            <ion-col size="4" class="qr-scanner">
              <ion-icon name="qr-scanner"></ion-icon> Name
            </ion-col>
          </ion-item>
        </ion-card-content>
      </ion-card>
    </div>

  </div>
  <div *ngIf="mode === 'discovery'">
    <div *ngIf="!devicePing.isNew">
      This device was configured previously with name
      <b>{{devicePing.name}}</b>
      <br/> Do you want keep this name or change it?
      <br/>
      <ion-button (click)="setDeviceName(devicePing.name,devicePing.chip)" color="primary">Keep</ion-button>
      <ion-button (click)="freshDevice()" color="primary">Start New</ion-button>
    </div>
    <div *ngIf="devicePing.isNew">
      This is a new device device, please set name for the device
      <ion-item>
        <ion-input [(ngModel)]="devicePing.name" required type="text" placeholder="Device Name.."></ion-input>
        <ion-button (click)="setDeviceName(devicePing.name,devicePing.chip)" color="primary">Set Name</ion-button>
      </ion-item>
    </div>
  </div>
  <div *ngIf="mode === 'scan'">
    <div *ngIf="isScanningDevice">
      Turn on Access point on your device and connect to the wifi network.
      <br/> Network name like xSmart-XXXXXX should show up on your phone.
      <br/> Connect to the network with password : 123456789
      <br/> Waiting to connect to wifi network
      <br/>
      <ion-spinner></ion-spinner>
    </div>
    <div *ngIf="xSmartConnect">
      <!-- {{devicePing.webid}} -->
      <p size="12">
        <span size="4" class="device-ID">Device ID:</span>
        <span class="device_device_id"> {{devicePing.chip}}</span>
      </p>
      <p size="12">
        <span size="4" class="device-ID">Device Chip:</span>
        <span class="device_device_id"> {{devicePing.chip}}</span>
      </p>
      <p size="12">
        <span size="4" class="device-ID">Device Name:</span>
        <span class="device_device_id"> {{devicePing.name}}</span>
      </p>
      <br/>
      <ion-button (click)="scanWifi()" color="primary">Getting Wifi Networks</ion-button>
      <Br/>
      <br>
      <div class="networkList">
        <ion-list *ngFor="let wifi of wifinetworks">
          <ion-item class="network" (click)="askWifiPassword(wifi)">
            <ion-item slot="start">
              <ion-icon slot="start" mode="ios" name="wifi"></ion-icon>
              <span>Network</span>
            </ion-item>
            <ion-label>
              <h2>{{wifi.SSID}}</h2>
              <div>
                {{wifi.RSSI}} -- {{wifi.ENC}}
              </div>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>
    </div>
  </div>
</ion-content>
<!-- --------------------------------------------new code---------------------- -->